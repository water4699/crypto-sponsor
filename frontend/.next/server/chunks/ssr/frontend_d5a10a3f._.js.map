{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/lib/utils.ts"],"sourcesContent":["import { clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\n/**\n * Utility helper to merge Tailwind CSS class names.\n *\n * - First resolves conditional classes via `clsx`\n * - Then merges conflicting Tailwind classes via `tailwind-merge`\n */\nexport function cn(...inputs: Array<string | number | null | undefined | false>) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,SAAS,GAAG,GAAG,MAAyD;IAC7E,OAAO,IAAA,kLAAO,EAAC,IAAA,yJAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,IAAA,mLAAG,EACxB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aAAa;YACb,SACE;YACF,WAAW;YACX,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,+NAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,oLAAI,GAAG;IAC9B,qBACE,0PAAC;QACC,WAAW,IAAA,8HAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\n        \"rounded-xl border border-border bg-card text-card-foreground shadow-sm\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nCard.displayName = \"Card\";\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\";\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n));\nCardTitle.displayName = \"CardTitle\";\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\";\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n));\nCardContent.displayName = \"CardContent\";\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n));\nCardFooter.displayName = \"CardFooter\";\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,+NAAgB,CAC3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,0PAAC;QACC,KAAK;QACL,WAAW,IAAA,8HAAE,EACX,0EACA;QAED,GAAG,KAAK;;;;;;AAIf,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,+NAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC;QACC,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,+NAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC;QACC,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,6CAA6C;QAC1D,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,+NAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC;QACC,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,+NAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC;QAAI,KAAK;QAAK,WAAW,IAAA,8HAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,+NAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC;QACC,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants };\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,mLAAG,EACvB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,0PAAC;QAAI,WAAW,IAAA,8HAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE","debugId":null}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/SponsorshipCard.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Lock, LockOpen, Eye, EyeOff } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAccount } from \"wagmi\";\nimport { toast } from \"sonner\";\n\ninterface SponsorshipDeal {\n  id: string;\n  title: string;\n  sponsor: string;\n  tournament: string;\n  value: string;\n  duration: string;\n  terms: string;\n  status: \"locked\" | \"unlocked\";\n  verifiedPartners: string[];\n}\n\ninterface SponsorshipCardProps {\n  deal: SponsorshipDeal;\n  onDecrypt: (id: string) => void;\n}\n\nconst SponsorshipCard = ({ deal, onDecrypt }: SponsorshipCardProps) => {\n  const [showDetails, setShowDetails] = useState(false);\n  const { address, isConnected } = useAccount();\n  const normalizedAddress = address?.toLowerCase();\n  const isVerified = normalizedAddress && deal.verifiedPartners.map((v) => v.toLowerCase()).includes(normalizedAddress);\n  const isLocked = deal.status === \"locked\";\n\n  const handleDecrypt = () => {\n    if (!isConnected) {\n      toast.error(\"Please connect your wallet first\");\n      return;\n    }\n    if (!isVerified) {\n      toast.error(\"You are not a verified partner for this deal\");\n      return;\n    }\n    onDecrypt(deal.id);\n    toast.success(\"Contract decrypted successfully\");\n  };\n\n  return (\n    <Card\n      className={`transition-all duration-300 hover:shadow-lg overflow-hidden ${\n        isLocked\n          ? \"border-locked/50 shadow-[0_0_20px_rgba(239,68,68,0.1)]\"\n          : \"border-success/50 shadow-[0_0_20px_rgba(34,197,94,0.1)]\"\n      }`}\n    >\n      <CardHeader>\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <CardTitle className=\"text-xl mb-2 break-words\">{deal.title || \"Untitled Deal\"}</CardTitle>\n            <CardDescription className=\"flex flex-col gap-1\">\n              <span className=\"text-sm\">\n                <strong>Sponsor:</strong> {deal.sponsor}\n              </span>\n              <span className=\"text-sm\">\n                <strong>Tournament:</strong> {deal.tournament}\n              </span>\n            </CardDescription>\n          </div>\n          <Badge\n            variant={isLocked ? \"destructive\" : \"default\"}\n            className={isLocked ? \"bg-locked\" : \"bg-success\"}\n          >\n            {isLocked ? (\n              <>\n                <Lock className=\"w-3 h-3 mr-1\" />\n                Locked\n              </>\n            ) : (\n              <>\n                <LockOpen className=\"w-3 h-3 mr-1\" />\n                Unlocked\n              </>\n            )}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <div className=\"grid grid-cols-2 gap-3\">\n          <div className=\"bg-muted/50 p-3 rounded-lg\">\n            <p className=\"text-xs text-muted-foreground mb-1\">Contract Value</p>\n            {isLocked ? (\n              <div className=\"flex items-center gap-2\">\n                <Lock className=\"w-4 h-4 text-locked\" />\n                <span className=\"text-sm font-mono\">••••••••</span>\n              </div>\n            ) : (\n              <p className=\"text-lg font-bold text-primary\">{deal.value}</p>\n            )}\n          </div>\n          <div className=\"bg-muted/50 p-3 rounded-lg\">\n            <p className=\"text-xs text-muted-foreground mb-1\">Duration</p>\n            {isLocked ? (\n              <div className=\"flex items-center gap-2\">\n                <Lock className=\"w-4 h-4 text-locked\" />\n                <span className=\"text-sm font-mono\">••••••••</span>\n              </div>\n            ) : (\n              <p className=\"text-lg font-bold text-primary\">{deal.duration}</p>\n            )}\n          </div>\n        </div>\n        <div className=\"bg-muted/50 p-3 rounded-lg\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <p className=\"text-xs text-muted-foreground\">Contract Terms</p>\n            {!isLocked && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowDetails(!showDetails)}\n                className=\"h-6 px-2\"\n              >\n                {showDetails ? (\n                  <>\n                    <EyeOff className=\"w-3 h-3 mr-1\" />\n                    Hide\n                  </>\n                ) : (\n                  <>\n                    <Eye className=\"w-3 h-3 mr-1\" />\n                    Show\n                  </>\n                )}\n              </Button>\n            )}\n          </div>\n          {isLocked ? (\n            <div className=\"flex items-center gap-2\">\n              <Lock className=\"w-4 h-4 text-locked\" />\n              <span className=\"text-sm font-mono\">████████████████████</span>\n            </div>\n          ) : showDetails ? (\n            <p className=\"text-sm text-foreground\">{deal.terms}</p>\n          ) : (\n            <p className=\"text-sm text-muted-foreground italic\">Click Show to view terms</p>\n          )}\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex gap-2\">\n        {isLocked ? (\n          <Button\n            onClick={handleDecrypt}\n            disabled={!isConnected || !isVerified}\n            className=\"w-full\"\n            variant=\"default\"\n          >\n            <Lock className=\"w-4 h-4 mr-2\" />\n            {!isConnected\n              ? \"Connect Wallet to Decrypt\"\n              : !isVerified\n              ? \"Not Authorized\"\n              : \"Decrypt Contract\"}\n          </Button>\n        ) : (\n          <Badge variant=\"outline\" className=\"w-full justify-center py-2 border-success text-success\">\n            <LockOpen className=\"w-4 h-4 mr-2\" />\n            Contract Accessible\n          </Badge>\n        )}\n      </CardFooter>\n    </Card>\n  );\n};\n\nexport default SponsorshipCard;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 626, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/dialog.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,SAAS,sLAAoB;AAEnC,MAAM,gBAAgB,yLAAuB;AAE7C,MAAM,eAAe,wLAAsB;AAE3C,MAAM,cAAc,uLAAqB;AAEzC,MAAM,8BAAgB,+NAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC,yLAAuB;QACtB,KAAK;QACL,WAAW,IAAA,8HAAE,EACX,2JACA;QAED,GAAG,KAAK;;;;;;AAGb,cAAc,WAAW,GAAG,yLAAuB,CAAC,WAAW;AAE/D,MAAM,8BAAgB,+NAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,0PAAC;;0BACC,0PAAC;;;;;0BACD,0PAAC,yLAAuB;gBACtB,KAAK;gBACL,WAAW,IAAA,8HAAE,EACX,+fACA;gBAED,GAAG,KAAK;;oBAER;kCACD,0PAAC,uLAAqB;wBAAC,WAAU;;0CAC/B,0PAAC,6MAAC;gCAAC,WAAU;;;;;;0CACb,0PAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAKlC,cAAc,WAAW,GAAG,yLAAuB,CAAC,WAAW;AAE/D,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,0PAAC;QACC,WAAW,IAAA,8HAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,aAAa,WAAW,GAAG;AAE3B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,0PAAC;QACC,WAAW,IAAA,8HAAE,EACX,iEACA;QAED,GAAG,KAAK;;;;;;AAGb,aAAa,WAAW,GAAG;AAE3B,MAAM,4BAAc,+NAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC,uLAAqB;QACpB,KAAK;QACL,WAAW,IAAA,8HAAE,EACX,qDACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,uLAAqB,CAAC,WAAW;AAE3D,MAAM,kCAAoB,+NAAgB,CAGxC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC,6LAA2B;QAC1B,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,kBAAkB,WAAW,GAAG,6LAA2B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 766, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,+NAAgB,CAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,0PAAC;QACC,MAAM;QACN,WAAW,IAAA,8HAAE,EACX,2WACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 794, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,gBAAgB,IAAA,mLAAG,EACvB;AAGF,MAAM,sBAAQ,+NAAgB,CAI5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,0PAAC,qLAAmB;QAClB,KAAK;QACL,WAAW,IAAA,8HAAE,EAAC,iBAAiB;QAC9B,GAAG,KAAK;;;;;;AAGb,MAAM,WAAW,GAAG,qLAAmB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 825, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAEA,MAAM,yBAAW,+NAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,0PAAC;QACC,WAAW,IAAA,8HAAE,EACX,6QACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AACA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 852, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/components/CreateDealButton.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { toast } from \"sonner\";\n\ninterface CreateDealButtonProps {\n  onCreateDeal: (\n    creator: string,\n    title: string,\n    description: string,\n    budget: number\n  ) => Promise<void>;\n  isCreating: boolean;\n  canCreate: boolean;\n}\n\nexport const CreateDealButton = ({\n  onCreateDeal,\n  isCreating,\n  canCreate,\n}: CreateDealButtonProps) => {\n  const [open, setOpen] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [creator, setCreator] = useState(\"\");\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [budget, setBudget] = useState(\"\");\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (isSubmitting) {\n      return;\n    }\n\n    if (!creator || !title || !description || !budget) {\n      toast.error(\"Please fill in all fields\");\n      return;\n    }\n\n    const budgetNum = parseInt(budget);\n    if (isNaN(budgetNum) || budgetNum <= 0) {\n      toast.error(\"Budget must be a positive number\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      await onCreateDeal(creator, title, description, budgetNum);\n      toast.success(\"Deal created successfully!\");\n      setOpen(false);\n      // Reset form\n      setCreator(\"\");\n      setTitle(\"\");\n      setDescription(\"\");\n      setBudget(\"\");\n    } catch (error) {\n      toast.error(\"Failed to create deal: \" + (error as Error).message);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button disabled={!canCreate} size=\"lg\" title={!canCreate ? \"Waiting for wallet and FHEVM instance...\" : \"Create a new deal\"}>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {!canCreate ? \"Initializing...\" : \"Create New Deal\"}\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[525px]\">\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>Create Sponsorship Deal</DialogTitle>\n            <DialogDescription>\n              Create a new encrypted sponsorship deal. The budget will be encrypted on-chain using FHE.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"creator\">Creator Address</Label>\n              <Input\n                id=\"creator\"\n                placeholder=\"0x...\"\n                value={creator}\n                onChange={(e) => setCreator(e.target.value)}\n                disabled={isCreating}\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"title\">Deal Title</Label>\n              <Input\n                id=\"title\"\n                placeholder=\"e.g., Major League Gaming Championship 2024\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                disabled={isCreating}\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"description\">Description</Label>\n              <Textarea\n                id=\"description\"\n                placeholder=\"Enter deal terms and description...\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                disabled={isCreating}\n                rows={4}\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"budget\">Budget (USD)</Label>\n              <Input\n                id=\"budget\"\n                type=\"number\"\n                placeholder=\"e.g., 500000\"\n                value={budget}\n                onChange={(e) => setBudget(e.target.value)}\n                disabled={isCreating}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                This value will be encrypted using FHE before storing on-chain\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button type=\"submit\" disabled={isCreating || !canCreate || isSubmitting}>\n              {isSubmitting ? \"Creating...\" : isCreating ? \"Initializing...\" : \"Create Deal\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1137, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 1146, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,uCAAuC;QACvC,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAwDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1251, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 1380, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAYS USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      \r\n      // Dynamic import with proper error handling. This is allowed both in\r\n      // development and production so that deployed frontends can still talk\r\n      // to a local Hardhat FHEVM node (chainId 31337).\r\n      try {\r\n        const fhevmMock = await import(\"./mock/fhevmMock\");\r\n        const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n          rpcUrl,\r\n          chainId,\r\n          metadata: fhevmRelayerMetadata,\r\n        });\r\n\r\n        throwIfAborted();\r\n\r\n        return mockInstance;\r\n      } catch (error) {\r\n        throw new Error(\r\n          'Mock FHEVM module not available. Please use a real FHEVM network (e.g., Sepolia testnet).'\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1611, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    // Provider or chainId has changed. Abort immediately\r\n    if (_abortControllerRef.current) {\r\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n\r\n    // Nullify instance immediately\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      // Force call main useEffect\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n\r\n    // Do not modify the running flag.\r\n  }, [provider, chainId]);\r\n\r\n  // Merge in main useEffect!!!\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  // Main useEffect\r\n  useEffect(() => {\r\n    // is _providerRef.current valid here ?\r\n    // even if the first useEffect is rendered in the same render-cycle ?\r\n    if (_isRunning === false) {\r\n      // cancelled\r\n      console.log(\"cancelled\");\r\n      if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      // May already be null if provider was changed in the previous render-cycle\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        // instance should be undefined\r\n        // this code below should be unecessary\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      // Keep old instance\r\n      // Was set to undefined if provider changed\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      // Can be undefined, if so, call eth_chainId\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          //console.log(`completed (runId=${thisRunId})...`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // is there a edge case where the assert below would fail ?\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          console.log(`Error Was thrown !!! error... ` + e.name);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(undefined);\r\n          _setError(e);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1750, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number; // Unix timestamp in seconds\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    // Partial type check\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.log(\"[FhevmDecryptionSignature] No cached signature found for key=\" + storageKey.key + \", will generate new one\");\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1981, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/abi/EncryptedSponsorDealABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedSponsorDealABI = {\n  \"abi\": [\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"DealBudgetUpdated\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"DealClosed\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"sponsor\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"creator\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"DealCreated\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"closeDeal\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"creator\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"description\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedBudget\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"createDeal\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getDealCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDealMeta\",\n      \"outputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"sponsor\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"address\",\n          \"name\": \"creator\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"description\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"bool\",\n          \"name\": \"active\",\n          \"type\": \"bool\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEncryptedBudget\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"dealId\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedDelta\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"increaseBudget\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,0BAA0B;IACrC,OAAO;QACL;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 2206, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/abi/EncryptedSponsorDealAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedSponsorDealAddresses = { \n  \"11155111\": { address: \"0x0000000000000000000000000000000000000000\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,gCAAgC;IAC3C,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 2229, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/hooks/useEncryptedSponsorDeal.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport {\n  RefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\n\nimport { EncryptedSponsorDealABI } from \"@/abi/EncryptedSponsorDealABI\";\nimport { EncryptedSponsorDealAddresses } from \"@/abi/EncryptedSponsorDealAddresses\";\n\ntype DealMeta = {\n  sponsor: string;\n  creator: string;\n  title: string;\n  description: string;\n  active: boolean;\n};\n\ntype EncryptedSponsorDealInfo = {\n  abi: typeof EncryptedSponsorDealABI.abi;\n  address?: `0x${string}`;\n  chainId?: number;\n  chainName?: string;\n};\n\nfunction getEncryptedSponsorDealByChainId(\n  chainId: number | undefined\n): EncryptedSponsorDealInfo {\n  if (!chainId) {\n    return { abi: EncryptedSponsorDealABI.abi };\n  }\n\n  const entry =\n    EncryptedSponsorDealAddresses[\n      chainId.toString() as keyof typeof EncryptedSponsorDealAddresses\n    ];\n\n  if (!(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\n    return { abi: EncryptedSponsorDealABI.abi, chainId };\n  }\n\n  return {\n    address: entry?.address as `0x${string}` | undefined,\n    chainId: entry?.chainId ?? chainId,\n    chainName: entry?.chainName,\n    abi: EncryptedSponsorDealABI.abi,\n  };\n}\n\nexport const useEncryptedSponsorDeal = (parameters: {\n  instance: FhevmInstance | undefined;\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\n  eip1193Provider: ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  ethersSigner: ethers.JsonRpcSigner | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\n  sameSigner: RefObject<\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean\n  >;\n  dealId: number;\n}) => {\n  const {\n    instance,\n    fhevmDecryptionSignatureStorage,\n    chainId,\n    ethersSigner,\n    ethersReadonlyProvider,\n    sameChain,\n    sameSigner,\n    dealId,\n  } = parameters;\n\n  const [meta, setMeta] = useState<DealMeta | undefined>(undefined);\n  const [budgetHandle, setBudgetHandle] = useState<string | undefined>(\n    undefined\n  );\n  const [clearBudget, setClearBudget] = useState<bigint | undefined>(undefined);\n  const clearBudgetRef = useRef<bigint | undefined>(undefined);\n  const [isRefreshing, setIsRefreshing] = useState<boolean>(false);\n  const [isDecrypting, setIsDecrypting] = useState<boolean>(false);\n  const [isCreating, setIsCreating] = useState<boolean>(false);\n  const [message, setMessage] = useState<string>(\"\");\n\n  const contractRef = useRef<EncryptedSponsorDealInfo | undefined>(undefined);\n  const isRefreshingRef = useRef<boolean>(isRefreshing);\n  const isDecryptingRef = useRef<boolean>(isDecrypting);\n  const isCreatingRef = useRef<boolean>(isCreating);\n\n  const isDecrypted = budgetHandle && clearBudget !== undefined;\n\n  const contract = useMemo(() => {\n    const c = getEncryptedSponsorDealByChainId(chainId);\n    contractRef.current = c;\n    if (!c.address) {\n      setMessage(\n        `EncryptedSponsorDeal deployment not found for chainId=${chainId}.`\n      );\n    }\n    return c;\n  }, [chainId]);\n\n  const isDeployed = useMemo(() => {\n    if (!contract) {\n      return undefined;\n    }\n    return Boolean(contract.address) && contract.address !== ethers.ZeroAddress;\n  }, [contract]);\n\n  const canRefresh = useMemo(() => {\n    return contract.address && ethersReadonlyProvider && !isRefreshing;\n  }, [contract.address, ethersReadonlyProvider, isRefreshing]);\n\n  const refreshDeal = useCallback(() => {\n    console.log(\"[useEncryptedSponsorDeal] call refreshDeal()\");\n    if (isRefreshingRef.current) {\n      return;\n    }\n\n    if (\n      !contractRef.current ||\n      !contractRef.current?.chainId ||\n      !contractRef.current?.address ||\n      !ethersReadonlyProvider\n    ) {\n      setMeta(undefined);\n      setBudgetHandle(undefined);\n      return;\n    }\n\n    isRefreshingRef.current = true;\n    setIsRefreshing(true);\n\n    const thisChainId = contractRef.current.chainId;\n    const thisContractAddress = contractRef.current.address;\n\n    const thisContract = new ethers.Contract(\n      thisContractAddress,\n      contractRef.current.abi,\n      ethersReadonlyProvider\n    );\n\n    Promise.all([\n      thisContract.getDealMeta(dealId),\n      thisContract.getEncryptedBudget(dealId),\n    ])\n      .then(([metaResult, budgetResult]) => {\n        console.log(\"[useEncryptedSponsorDeal] Contract interaction successful\");\n        console.log(\"[useEncryptedSponsorDeal] Chain ID:\", thisChainId);\n        console.log(\"[useEncryptedSponsorDeal] Contract address:\", thisContractAddress);\n        console.log(\"[useEncryptedSponsorDeal] Deal ID:\", dealId);\n        console.log(\"[useEncryptedSponsorDeal] getDealMeta()=\", metaResult);\n        console.log(\n          \"[useEncryptedSponsorDeal] getEncryptedBudget()=\",\n          budgetResult\n        );\n\n        if (\n          sameChain.current(thisChainId) &&\n          thisContractAddress === contractRef.current?.address\n        ) {\n          setMeta({\n            sponsor: metaResult[0],\n            creator: metaResult[1],\n            title: metaResult[2],\n            description: metaResult[3],\n            active: metaResult[4],\n          });\n          setBudgetHandle(budgetResult);\n        }\n\n        isRefreshingRef.current = false;\n        setIsRefreshing(false);\n      })\n      .catch((e) => {\n        setMessage(\n          \"EncryptedSponsorDeal.getDealMeta() or getEncryptedBudget() call failed! error=\" +\n            e\n        );\n\n        isRefreshingRef.current = false;\n        setIsRefreshing(false);\n      });\n  }, [ethersReadonlyProvider, sameChain, dealId]);\n\n  // Auto refresh the deal\n  useEffect(() => {\n    refreshDeal();\n  }, [refreshDeal]);\n\n  const canDecrypt = useMemo(() => {\n    return (\n      contract.address &&\n      instance &&\n      ethersSigner &&\n      !isRefreshing &&\n      !isDecrypting &&\n      budgetHandle &&\n      budgetHandle !== ethers.ZeroHash &&\n      clearBudget === undefined\n    );\n  }, [\n    contract.address,\n    instance,\n    ethersSigner,\n    isRefreshing,\n    isDecrypting,\n    budgetHandle,\n    clearBudget,\n  ]);\n\n  const decryptBudget = useCallback(() => {\n    if (isRefreshingRef.current || isDecryptingRef.current) {\n      return;\n    }\n\n    if (!contract.address || !instance || !ethersSigner) {\n      return;\n    }\n\n    if (!budgetHandle) {\n      setClearBudget(undefined);\n      clearBudgetRef.current = undefined;\n      return;\n    }\n\n    if (budgetHandle === ethers.ZeroHash) {\n      setClearBudget(BigInt(0));\n      clearBudgetRef.current = BigInt(0);\n      return;\n    }\n\n    const thisChainId = chainId;\n    const thisContractAddress = contract.address;\n    const thisBudgetHandle = budgetHandle;\n    const thisEthersSigner = ethersSigner;\n\n    isDecryptingRef.current = true;\n    setIsDecrypting(true);\n    setMessage(\"Start decrypt budget\");\n\n    const run = async () => {\n      const isStale = () =>\n        thisContractAddress !== contractRef.current?.address ||\n        !sameChain.current(thisChainId) ||\n        !sameSigner.current(thisEthersSigner);\n\n      try {\n        const sig: FhevmDecryptionSignature | null =\n          await FhevmDecryptionSignature.loadOrSign(\n            instance,\n            [contract.address as `0x${string}`],\n            ethersSigner,\n            fhevmDecryptionSignatureStorage\n          );\n\n        if (!sig) {\n          setMessage(\"Unable to build FHEVM decryption signature\");\n          return;\n        }\n\n        if (isStale()) {\n          setMessage(\"Ignore FHEVM decryption\");\n          return;\n        }\n\n        setMessage(\"Call FHEVM userDecrypt...\");\n\n        const res = await instance.userDecrypt(\n          [\n            {\n              handle: thisBudgetHandle,\n              contractAddress: thisContractAddress,\n            },\n          ],\n          sig.privateKey,\n          sig.publicKey,\n          sig.signature,\n          sig.contractAddresses,\n          sig.userAddress,\n          sig.startTimestamp,\n          sig.durationDays\n        );\n\n        setMessage(\"FHEVM userDecrypt completed!\");\n\n        if (isStale()) {\n          setMessage(\"Ignore FHEVM decryption\");\n          return;\n        }\n\n        const decryptedBudget = BigInt(res[thisBudgetHandle]);\n        setClearBudget(decryptedBudget);\n        clearBudgetRef.current = decryptedBudget;\n\n        setMessage(\"Budget decrypted: \" + decryptedBudget.toString());\n      } finally {\n        isDecryptingRef.current = false;\n        setIsDecrypting(false);\n      }\n    };\n\n    run();\n  }, [\n    fhevmDecryptionSignatureStorage,\n    ethersSigner,\n    contract.address,\n    instance,\n    budgetHandle,\n    chainId,\n    sameChain,\n    sameSigner,\n  ]);\n\n  const canCreate = useMemo(() => {\n    const result = contract.address && instance && ethersSigner && !isCreating;\n    console.log(\"[useEncryptedSponsorDeal] canCreate check:\", {\n      hasAddress: !!contract.address,\n      hasInstance: !!instance,\n      hasSigner: !!ethersSigner,\n      isCreating,\n      result,\n    });\n    return result;\n  }, [contract.address, instance, ethersSigner, isCreating]);\n\n  const createDeal = useCallback(\n    async (\n      creator: string,\n      title: string,\n      description: string,\n      budget: number\n    ) => {\n      if (isCreatingRef.current) {\n        throw new Error(\"Already creating a deal\");\n      }\n\n      if (!contract.address || !instance || !ethersSigner) {\n        throw new Error(\"Contract, FHEVM instance, or signer not available\");\n      }\n\n      isCreatingRef.current = true;\n      setIsCreating(true);\n      setMessage(\"Encrypting budget...\");\n\n      try {\n        // Encrypt budget\n        const input = instance.createEncryptedInput(\n          contract.address,\n          await ethersSigner.getAddress()\n        );\n        input.add32(budget);\n        const encryptedBudget = await input.encrypt();\n\n        setMessage(\"Creating deal transaction...\");\n\n        // Create contract instance\n        const contractInstance = new ethers.Contract(\n          contract.address,\n          contract.abi,\n          ethersSigner\n        );\n\n        // Send transaction\n        const tx = await contractInstance.createDeal(\n          creator,\n          title,\n          description,\n          encryptedBudget.handles[0],\n          encryptedBudget.inputProof\n        );\n\n        setMessage(\"Waiting for confirmation...\");\n        await tx.wait();\n\n        setMessage(\"Deal created successfully!\");\n\n        // Refresh to load new deal\n        setTimeout(() => refreshDeal(), 1000);\n      } finally {\n        isCreatingRef.current = false;\n        setIsCreating(false);\n      }\n    },\n    [contract.address, contract.abi, instance, ethersSigner, refreshDeal]\n  );\n\n  return {\n    contractAddress: contract.address,\n    canDecrypt,\n    canRefresh,\n    canCreate,\n    decryptBudget,\n    refreshDeal,\n    createDeal,\n    isDecrypted,\n    message,\n    meta,\n    clearBudget,\n    budgetHandle,\n    isDecrypting,\n    isRefreshing,\n    isCreating,\n    isDeployed,\n  };\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2513, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/hooks/useAllDeals.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { EncryptedSponsorDealABI } from \"@/abi/EncryptedSponsorDealABI\";\nimport { EncryptedSponsorDealAddresses } from \"@/abi/EncryptedSponsorDealAddresses\";\n\ntype DealMeta = {\n  dealId: number;\n  sponsor: string;\n  creator: string;\n  title: string;\n  description: string;\n  active: boolean;\n};\n\ntype ContractInfo = {\n  abi: typeof EncryptedSponsorDealABI.abi;\n  address?: `0x${string}`;\n  chainId?: number;\n  chainName?: string;\n};\n\nfunction getContractByChainId(chainId: number | undefined): ContractInfo {\n  if (!chainId) {\n    return { abi: EncryptedSponsorDealABI.abi };\n  }\n\n  const entry =\n    EncryptedSponsorDealAddresses[\n      chainId.toString() as keyof typeof EncryptedSponsorDealAddresses\n    ];\n\n  if (!(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\n    return { abi: EncryptedSponsorDealABI.abi, chainId };\n  }\n\n  return {\n    address: entry?.address as `0x${string}` | undefined,\n    chainId: entry?.chainId ?? chainId,\n    chainName: entry?.chainName,\n    abi: EncryptedSponsorDealABI.abi,\n  };\n}\n\nexport const useAllDeals = (parameters: {\n  chainId: number | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n}) => {\n  const { chainId, ethersReadonlyProvider } = parameters;\n\n  const [deals, setDeals] = useState<DealMeta[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<string | undefined>(undefined);\n\n  const isLoadingRef = useRef<boolean>(false);\n\n  const contract = useMemo(() => {\n    return getContractByChainId(chainId);\n  }, [chainId]);\n\n  const isDeployed = useMemo(() => {\n    if (!contract) {\n      return undefined;\n    }\n    return Boolean(contract.address) && contract.address !== ethers.ZeroAddress;\n  }, [contract]);\n\n  const loadAllDeals = useCallback(async () => {\n    if (isLoadingRef.current) {\n      return;\n    }\n\n    if (!contract.address || !ethersReadonlyProvider) {\n      setDeals([]);\n      return;\n    }\n\n    isLoadingRef.current = true;\n    setIsLoading(true);\n    setError(undefined);\n\n    try {\n      const contractInstance = new ethers.Contract(\n        contract.address,\n        contract.abi,\n        ethersReadonlyProvider\n      );\n\n      // Get total deal count\n      const dealCount = await contractInstance.getDealCount();\n      const count = Number(dealCount);\n\n      console.log(`[useAllDeals] Total deals: ${count}`);\n\n      if (count === 0) {\n        setDeals([]);\n        return;\n      }\n\n      // Load all deals in parallel with batch processing for performance\n      const dealPromises: Promise<DealMeta>[] = [];\n      const batchSize = 10; // Process deals in batches to avoid overwhelming the network\n      \n      for (let i = 1; i <= count; i++) {\n        dealPromises.push(\n          contractInstance.getDealMeta(i).then((meta: any) => ({\n            dealId: i,\n            sponsor: meta[0],\n            creator: meta[1],\n            title: meta[2],\n            description: meta[3],\n            active: meta[4],\n          }))\n        );\n        \n        // Process in batches to prevent rate limiting\n        if (i % batchSize === 0 || i === count) {\n          await new Promise(resolve => setTimeout(resolve, 100));\n        }\n      }\n\n      const allDeals = await Promise.all(dealPromises);\n      \n      // Filter out empty deals (zero address sponsor)\n      const validDeals = allDeals.filter(\n        (deal) => deal.sponsor !== ethers.ZeroAddress\n      );\n\n      console.log(`[useAllDeals] Loaded ${validDeals.length} valid deals`);\n      setDeals(validDeals);\n    } catch (e) {\n      console.error(\"[useAllDeals] Error loading deals:\", e);\n      setError((e as Error).message);\n      setDeals([]);\n    } finally {\n      isLoadingRef.current = false;\n      setIsLoading(false);\n    }\n  }, [contract.address, contract.abi, ethersReadonlyProvider]);\n\n  // Auto-load on mount and when dependencies change\n  useEffect(() => {\n    loadAllDeals();\n  }, [loadAllDeals]);\n\n  return {\n    deals,\n    isLoading,\n    error,\n    isDeployed,\n    contractAddress: contract.address,\n    reload: loadAllDeals,\n  };\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2640, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/huangchen/crypto-sponsor-key-main/crypto-sponsor-key-main/frontend/app/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Shield, Lock, Users } from \"lucide-react\";\r\nimport SponsorshipCard from \"@/components/SponsorshipCard\";\r\nimport { CreateDealButton } from \"@/components/CreateDealButton\";\r\nimport { useFhevm } from \"@/fhevm/useFhevm\";\r\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\r\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\r\nimport { useEncryptedSponsorDeal } from \"@/hooks/useEncryptedSponsorDeal\";\r\nimport { useAllDeals } from \"@/hooks/useAllDeals\";\r\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\r\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\r\nimport { ethers } from \"ethers\";\r\nimport { RefObject } from \"react\";\r\n\r\n// Individual deal card component that manages its own decrypt state\r\nfunction DealCard({\r\n  dealMeta,\r\n  fhevmInstance,\r\n  fhevmDecryptionSignatureStorage,\r\n  provider,\r\n  chainId,\r\n  ethersSigner,\r\n  ethersReadonlyProvider,\r\n  sameChain,\r\n  sameSigner,\r\n}: {\r\n  dealMeta: {\r\n    dealId: number;\r\n    sponsor: string;\r\n    creator: string;\r\n    title: string;\r\n    description: string;\r\n    active: boolean;\r\n  };\r\n  fhevmInstance: FhevmInstance | undefined;\r\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\r\n  provider: ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  ethersSigner: ethers.JsonRpcSigner | undefined;\r\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\r\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\r\n  sameSigner: RefObject<\r\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean\r\n  >;\r\n}) {\r\n  const dealData = useEncryptedSponsorDeal({\r\n    instance: fhevmInstance,\r\n    fhevmDecryptionSignatureStorage,\r\n    eip1193Provider: provider,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n    dealId: dealMeta.dealId,\r\n  });\r\n\r\n  const deal = {\r\n    id: dealMeta.dealId.toString(),\r\n    title: dealMeta.title || \"Untitled Deal\",\r\n    sponsor: dealMeta.sponsor,\r\n    tournament: \"On-chain Encrypted Sponsorship\",\r\n    value: dealData.isDecrypted\r\n      ? `$${dealData.clearBudget?.toString()}`\r\n      : \"Encrypted\",\r\n    duration: dealMeta.active ? \"Active\" : \"Closed\",\r\n    terms: dealMeta.description || \"No description available\",\r\n    status: (dealData.isDecrypted ? \"unlocked\" : \"locked\") as\r\n      | \"locked\"\r\n      | \"unlocked\",\r\n    verifiedPartners: [dealMeta.sponsor, dealMeta.creator],\r\n  };\r\n\r\n  return (\r\n    <SponsorshipCard\r\n      deal={deal}\r\n      onDecrypt={() => dealData.decryptBudget()}\r\n    />\r\n  );\r\n}\r\n\r\nexport default function Home() {\r\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\r\n  const {\r\n    provider,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n    initialMockChains,\r\n  } = useMetaMaskEthersSigner();\r\n\r\n  const {\r\n    instance: fhevmInstance,\r\n  } = useFhevm({\r\n    provider,\r\n    chainId,\r\n    initialMockChains,\r\n    enabled: true,\r\n  });\r\n\r\n  // Load all deals\r\n  const { deals, isLoading: isLoadingDeals, reload: reloadDeals } = useAllDeals({\r\n    chainId,\r\n    ethersReadonlyProvider,\r\n  });\r\n\r\n  // Use single deal hook for create functionality\r\n  const dealData = useEncryptedSponsorDeal({\r\n    instance: fhevmInstance,\r\n    fhevmDecryptionSignatureStorage,\r\n    eip1193Provider: provider,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n    dealId: 1, // This is just for create functionality\r\n  });\r\n\r\n  return (\r\n    <div className=\"min-h-[calc(100vh-5rem)] bg-background\">\r\n      <main className=\"container mx-auto px-4 py-10 space-y-12\">\r\n        <section className=\"text-center space-y-4\">\r\n          <p className=\"text-sm uppercase tracking-[0.35em] text-primary\">Encrypted Sponsorships</p>\r\n          <h1 className=\"text-4xl md:text-5xl font-bold text-foreground\">\r\n            Secure Your Sponsorship Agreements\r\n          </h1>\r\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\r\n            Store and manage tournament sponsorship deals with end-to-end encryption. Only verified partners\r\n            can access sensitive contract details, ensuring total confidentiality across the lifecycle.\r\n          </p>\r\n        </section>\r\n\r\n        <section className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <article className=\"bg-card border border-border rounded-2xl p-6 text-center shadow-sm hover:shadow-lg transition-shadow\">\r\n            <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 mb-4\">\r\n              <Shield className=\"w-6 h-6 text-primary\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-foreground mb-2\">End-to-End Encryption</h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Zama FHEVM keeps commercial agreements private even when stored and processed on-chain.\r\n            </p>\r\n          </article>\r\n          <article className=\"bg-card border border-border rounded-2xl p-6 text-center shadow-sm hover:shadow-lg transition-shadow\">\r\n            <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-accent/10 mb-4\">\r\n              <Lock className=\"w-6 h-6 text-accent\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-foreground mb-2\">Verified Access Only</h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Wallet-based verification ensures only trusted partners can decrypt and review contract terms.\r\n            </p>\r\n          </article>\r\n          <article className=\"bg-card border border-border rounded-2xl p-6 text-center shadow-sm hover:shadow-lg transition-shadow\">\r\n            <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-success/10 mb-4\">\r\n              <Users className=\"w-6 h-6 text-success\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-foreground mb-2\">Partner Management</h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Control who can view, update, and decrypt each sponsorship deal in a single interface.\r\n            </p>\r\n          </article>\r\n        </section>\r\n\r\n        <section className=\"space-y-6\">\r\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n            <div className=\"flex flex-col gap-2\">\r\n              <h2 className=\"text-2xl font-bold text-foreground\">Active Sponsorship Deals</h2>\r\n              <p className=\"text-muted-foreground max-w-2xl\">\r\n                Each card represents an encrypted agreement stored on-chain. Authorized partners can decrypt\r\n                the financials and terms directly from the UI.\r\n              </p>\r\n            </div>\r\n            <CreateDealButton\r\n              onCreateDeal={async (creator, title, description, budget) => {\r\n                await dealData.createDeal(creator, title, description, budget);\r\n                // Reload all deals after creating\r\n                setTimeout(() => reloadDeals(), 1500);\r\n              }}\r\n              isCreating={dealData.isCreating}\r\n              canCreate={dealData.canCreate ?? false}\r\n            />\r\n          </div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {isLoadingDeals ? (\r\n              <div className=\"col-span-full bg-muted/60 border border-border rounded-2xl p-8 text-center\">\r\n                <p className=\"text-muted-foreground\">Loading deals...</p>\r\n              </div>\r\n            ) : deals.length > 0 ? (\r\n              deals.map((dealMeta) => (\r\n                <DealCard\r\n                  key={dealMeta.dealId}\r\n                  dealMeta={dealMeta}\r\n                  fhevmInstance={fhevmInstance}\r\n                  fhevmDecryptionSignatureStorage={fhevmDecryptionSignatureStorage}\r\n                  provider={provider}\r\n                  chainId={chainId}\r\n                  ethersSigner={ethersSigner}\r\n                  ethersReadonlyProvider={ethersReadonlyProvider}\r\n                  sameChain={sameChain}\r\n                  sameSigner={sameSigner}\r\n                />\r\n              ))\r\n            ) : (\r\n              <div className=\"col-span-full bg-muted/60 border border-border rounded-2xl p-8 text-center\">\r\n                <p className=\"text-muted-foreground\">\r\n                  {dealData.isDeployed === false\r\n                    ? \"EncryptedSponsorDeal contract not deployed on this network.\"\r\n                    : \"No deals found. Click 'Create New Deal' to get started!\"}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </section>\r\n\r\n        <section className=\"bg-muted/60 border border-border rounded-2xl p-6\">\r\n          <h3 className=\"font-semibold text-foreground mb-4\">How It Works</h3>\r\n          <ol className=\"space-y-3 text-sm text-muted-foreground\">\r\n            <li className=\"flex gap-3\">\r\n              <span className=\"font-semibold text-primary\">1.</span>\r\n              Connect your RainbowKit wallet to authenticate.\r\n            </li>\r\n            <li className=\"flex gap-3\">\r\n              <span className=\"font-semibold text-primary\">2.</span>\r\n              Browse encrypted sponsorship deals sourced directly from our smart contracts.\r\n            </li>\r\n            <li className=\"flex gap-3\">\r\n              <span className=\"font-semibold text-primary\">3.</span>\r\n              If you are a verified partner, decrypt budgets and contract terms securely.\r\n            </li>\r\n            <li className=\"flex gap-3\">\r\n              <span className=\"font-semibold text-primary\">4.</span>\r\n              Approve updates or close deals—all actions remain encrypted end-to-end.\r\n            </li>\r\n          </ol>\r\n        </section>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}